## 🔍 ④ **RECOMMEND_TB / SEARCH_LOG_TB (추천 & 검색 담당)**

**담당자:** 메뉴 추천, 검색 히스토리 저장, AI 피드백

### `RECOMMEND_TB`

| 컬럼명          | 타입            | 제약조건            | 설명                     |
| ------------ | ------------- | --------------- | ---------------------- |
| `rec_id`     | NUMBER(8)     | PK              | 추천 고유번호                |
| `user_id`    | VARCHAR2(30)  | FK → USER_TB    | 사용자 ID                 |
| `food_id`    | NUMBER(6)     | FK → FOOD_TB    | 추천된 음식                 |
| `type`       | VARCHAR2(30)  |                 | 추천 유형 (AI, 랜덤, 재료기반 등) |
| `feedback`   | VARCHAR2(200) |          null      | AI 피드백 (예: 단백질 부족)     
|` is_favorite` |CHAR(1) | DEFAULT| 'N' 사용자가 추천| 음식을 ‘찜’했는지 여부 ('Y': 찜함, 'N': 안함) |
| `created_at` | DATE          | DEFAULT SYSDATE | 추천 일시                  |

1   1   1   


### `SEARCH_LOG_TB`

| 컬럼명          | 타입            | 제약조건            | 설명                |
| ------------ | ------------- | --------------- | ----------------- |
| `search_id`  | NUMBER(8)     | PK              | 검색 기록 ID          |
| `user_id`    | VARCHAR2(30)  | FK → USER_TB    | 사용자 ID            |
| `keyword`    | VARCHAR2(100) |                 | 검색 키워드            |
| `filter`     | VARCHAR2(100) |                 | 필터 조건 (비건, 고단백 등) |
| `recent_search` |CHAR(1) | DEFAULT | 'Y' 해당 검색어를 최근 검색 목록에 표시할지 여부 ('Y': 표시, 'N': 비표시)||
| `created_at` | DATE          | DEFAULT SYSDATE | 검색 시각             |

🔹 **CRUD 예시**

* Create: 추천 결과 저장, 검색 로그 기록
* Read: “나의 추천 기록”, “최근 검색어”
* Update: 피드백 내용 수정
* Delete: 오래된 기록 삭제

---

1️⃣ RECOMMEND_TB – 추가 컬럼: is_favorite (찜/즐겨찾기)
컬럼명	타입	제약조건	설명
is_favorite	CHAR(1)	DEFAULT 'N'	사용자가 추천 음식을 ‘찜’했는지 여부 ('Y': 찜함, 'N': 안함)

실용성 이유:

대부분의 쇼핑몰, 음식 앱, 콘텐츠 추천 사이트에서 추천된 항목을 찜하기/저장 기능 제공.

사용자가 나중에 다시 보고 싶을 때 쉽게 확인 가능.

추천 알고리즘에도 반영 가능 (찜한 음식 우선 추천).

2️⃣ SEARCH_LOG_TB – 추가 컬럼: recent_search (최근 검색 표시용)
컬럼명	타입	제약조건	설명
recent_search	CHAR(1)	DEFAULT 'Y'	해당 검색어를 최근 검색 목록에 표시할지 여부 ('Y': 표시, 'N': 비표시)

실용성 이유:

거의 모든 홈페이지/앱에서 최근 검색어 자동 표시 기능 제공.

사용자가 검색창을 클릭하면 바로 최근 검색어 보여주어 편리.

오래된 검색어는 비활성화(N) 처리 가능.


1️⃣ RECOMMEND_TB 
RECOMMEND_TB 
CREATE TABLE RECOMMEND_TB (
    recId NUMBER(8) PRIMARY KEY,        -- 추천 고유번호  
    userId VARCHAR2(30) NOT NULL,       -- 사용자 ID
    foodId NUMBER(6) NOT NULL,          -- 추천된 음식     
    type VARCHAR2(30) NOT NULL,         -- 추천 유형 (선호식단, AI, 재료기반)
    feedback VARCHAR2(200),             -- AI 피드백 (예: 단백질 부족)   
    createdAt DATE DEFAULT SYSDATE      -- 추천 일시  
);

2️⃣ SEARCH_LOG_TB
CREATE TABLE SEARCH_LOG_TB (
    search_id NUMBER(8) PRIMARY KEY,
    user_id VARCHAR2(30) NOT NULL,
    keyword VARCHAR2(100) NOT NULL,
    filter VARCHAR2(100),
    created_at DATE DEFAULT SYSDATE,
    recent_search CHAR(1) DEFAULT 'Y',
    CONSTRAINT fk_search_user FOREIGN KEY (user_id) REFERENCES USER_TB(id)

);

------------------------------------------------------------------
사용자가 검색어나 필터(type, filter)를 입력하면,
그 값들을 WHERE 조건으로 걸어서 FOOD_TB에서 데이터를 가져오게 됩니다.
예를 들어,

검색창에 “닭가슴살” 입력 시 → FOOD_TB의 name 컬럼에서 LIKE '%닭가슴살%'

필터를 “고단백”으로 선택 시 → FOOD_TB의 protein 값이 일정 기준 이상인 음식만 조회

이렇게 조회된 결과는 화면에 보여주고,
동시에 검색 내용을 SEARCH_LOG_TB에 저장해서 “최근 검색어” 기능에 활용합니다.
추천의 경우는 사용자의 preference(선호식단), allergy(알러지 정보) 등을 참고해서
FOOD_TB에서 조건에 맞는 데이터를 AI나 랜덤 방식으로 추출해 RECOMMEND_TB에 저장하는 식으로 구현할 예정입니다.

🔍 조금 더 구체적인 예시 (SQL 예시로 같이 보여주기 좋음)
🔸 검색 기능
-- 예: "한식" + "고단백" 필터로 검색
SELECT *
FROM FOOD_TB
WHERE category = '한식'
  AND protein > 20
  AND name LIKE '%닭%'
ORDER BY reg_date DESC;


→ 이렇게 검색된 결과를 화면에 띄우고,
→ 동시에 SEARCH_LOG_TB에 다음처럼 기록합니다:

INSERT INTO SEARCH_LOG_TB (search_id, user_id, keyword, filter)
VALUES (SEARCH_SEQ.NEXTVAL, 'user01', '닭', '한식,고단백');

🔸 추천 기능
-- 예: 선호식이 '다이어트'인 유저에게 저칼로리 음식 추천
SELECT *
FROM FOOD_TB
WHERE kcal <= 400
  AND category IN ('한식', '샐러드')
FETCH FIRST 3 ROWS ONLY;

-- 추천 결과를 저장
INSERT INTO RECOMMEND_TB (rec_id, user_id, food_id, type)
VALUES (REC_SEQ.NEXTVAL, 'user01', 101, 'AI');

💡 한 줄 요약 버전 (팀 회의용 짧게 말하기)

사용자가 입력한 검색어나 필터값을 SQL의 WHERE 조건으로 걸어서
FOOD_TB에서 데이터를 가져오고, 그 결과를 SEARCH_LOG_TB / RECOMMEND_TB에 기록하는 방식으로 구현하려 합니다.