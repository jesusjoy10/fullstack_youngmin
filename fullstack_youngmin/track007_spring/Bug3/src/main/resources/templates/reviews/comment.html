<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">

<div layout:fragment="content">

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">

            <div class="card shadow-sm">
                <div class="card-body p-4">

                    <h4 class="fw-bold mb-3">
                        <i class="bi bi-chat-left-text text-primary"></i>
                        ë¦¬ë·° ì‘ì„±
                    </h4>
                     <p class="text-muted mb-4">
                        ì§ì ‘ ë¨¹ì–´ë³¸ ì†”ì§í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš” ğŸ˜Š
                    </p>

                    <form id="reviewForm"
                          th:action="@{/reviews/review/comment}"
                          method="post">

                        <input type="hidden" name="recipeId" th:value="${recipeId}">
                        <input type="hidden" id="rating" name="rating">

                        <!-- â­ ë³„ì  -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">ë³„ì </label>
                            <div id="starRating"
                                 class="d-flex gap-2"
                                 style="font-size: 2.2rem; cursor: pointer;">
                                <i class="bi bi-star" data-value="1"></i>
                                <i class="bi bi-star" data-value="2"></i>
                                <i class="bi bi-star" data-value="3"></i>
                                <i class="bi bi-star" data-value="4"></i>
                                <i class="bi bi-star" data-value="5"></i>
                            </div>
                            <div id="ratingError"
                                 class="text-danger small d-none">
                                â­ ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                            </div>
                        </div>

                        <!-- âœ ë¦¬ë·° -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">ë¦¬ë·° ë‚´ìš©</label>
                            <textarea class="form-control"
                                      id="commentText"
                                      name="commentText"
                                      rows="5"
                                      maxlength="300"
                                      placeholder="ìµœëŒ€ 300ìê¹Œì§€ ì‘ì„±í•  ìˆ˜ ìˆì–´ìš”"></textarea>
                            <div class="text-end small text-muted mt-1">
                                <span id="textCount">0</span> / 300ì
                            </div>
                        </div>

                        <!-- ë²„íŠ¼ -->
                        <div class="d-flex justify-content-end gap-2">
                            <a href="javascript:history.back()"
                               class="btn btn-outline-secondary">
                                ì·¨ì†Œ
                            </a>
                            <button type="submit"
                                    class="btn btn-primary">
                                <i class="bi bi-check-circle"></i>
                                ë“±ë¡
                            </button>
                        </div>

                    </form>

                </div>
            </div>

        </div>
    </div>

</div>

<!-- ğŸ”” Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="successToast"
         class="toast align-items-center text-bg-success border-0"
         role="alert">
        <div class="d-flex">
            <div class="toast-body">
                ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰
            </div>
            <button type="button"
                    class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* â­ ë³„ì  */
    const stars = document.querySelectorAll('#starRating i');
    const ratingInput = document.getElementById('rating');
    const ratingError = document.getElementById('ratingError');

    stars.forEach(star => {
        star.addEventListener('mouseover', () => fillStars(star.dataset.value));
        star.addEventListener('click', () => {
            ratingInput.value = star.dataset.value;
            ratingError.classList.add('d-none');
        });
        star.addEventListener('mouseout', () => fillStars(ratingInput.value));
    });

    function fillStars(value) {
        stars.forEach(s => {
            if (s.dataset.value <= value) {
                s.classList.replace('bi-star', 'bi-star-fill');
                s.classList.add('text-warning');
            } else {
                s.classList.replace('bi-star-fill', 'bi-star');
                s.classList.remove('text-warning');
            }
        });
    }

    /* âœ ê¸€ììˆ˜ ì¹´ìš´í„° */
    const textarea = document.getElementById('commentText');
    const counter = document.getElementById('textCount');

    textarea.addEventListener('input', () => {
        counter.textContent = textarea.value.length;
    });

    /* ğŸš« submit ê²€ì¦ */
    document.getElementById('reviewForm').addEventListener('submit', function (e) {
        if (!ratingInput.value) {
            e.preventDefault();
            ratingError.classList.remove('d-none');
            return;
        }

        // Toast í‘œì‹œ
        const toast = new bootstrap.Toast(
            document.getElementById('successToast')
        );
        toast.show();
    });

});
</script>
</th:block>

</html>
